---
title: "R-4.4.1-NM_Statistics"
---

```{r}
#| label: API-call-one-time
#| echo: false

library(rjson)
library(httr)

  base_url <- "http://apis.data.go.kr/B551182/mdlrtActionInfoService"
  call_url <- "getMdlrtActionByClassesStats"
  My_API_Key <- "DRwFWZ/jfi6551teJKgRhkKgC+XhcjobN+ccY2MQdF9yZdx8xL5Kn4IljljMCWGsl2ObEco/rm21r14CN7iG0g=="
  params <- list(
    serviceKey = My_API_Key,
    pageNo = 1,
    numOfRows = 10,
    resultType = "json",
    year = "2023",
    stdType = "1",
    st5Cd = "HK010"
  )
  
  # API 호출
  url <- paste0(base_url, "/", call_url)
  response <- GET(url, query = params)

  if (status_code(response) == 200) {
    json_text <- content(response, as = "text")
    data <- fromJSON(json_text)
  } else {
    print(paste("API 호출 실패:", status_code(response)))
  }
```

```{r}
#| label: API-call-while-loop
#| echo: false
#| 
library(rjson)
library(httr)

# 현재 연도를 설정
my_year <- as.numeric(format(Sys.Date(), "%Y"))

# API 기본 URL 및 키 설정
base_url <- "http://apis.data.go.kr/B551182/mdlrtActionInfoService"
call_url <- "getMdlrtActionByClassesStats"
My_API_Key <- "DRwFWZ/jfi6551teJKgRhkKgC+XhcjobN+ccY2MQdF9yZdx8xL5Kn4IljljMCWGsl2ObEco/rm21r14CN7iG0g=="

# 조건 변수 설정
xcondition <- TRUE  

while (xcondition) {
  # API 요청 매개변수 설정
  params <- list(
    serviceKey = URLencode(My_API_Key),
    pageNo = 1,
    numOfRows = 10,
    resultType = "json",
    year = as.character(my_year),
    stdType = "1",
    st5Cd = "HK010"
  )
  
  # API 호출 URL 설정
  url <- paste0(base_url, "/", call_url)
  response <- GET(url, query = params)

  if (status_code(response) == 200) {
    json_text <- content(response, as = "text")
    data <- fromJSON(json_text)
    
    # totalCount가 존재하는지 확인 후 출력
    if (!is.null(data$response$body$totalCount)) {
      print(paste("연도:", my_year, "- totalCount:", data$response$body$totalCount))
      
      # totalCount가 5인 경우 루프 종료
      if (data$response$body$totalCount == 5) {
        xcondition <- FALSE
        print("totalCount가 5에 도달하여 루프를 종료합니다.")
      }
    } else {
      print("totalCount 값이 없습니다. 루프 종료.")
      xcondition <- FALSE
    }
  } else {
    print(paste("API 호출 실패:", status_code(response), "연도:", my_year))
    xcondition <- FALSE  # 오류 발생 시 루프 종료
  }
  
  # 연도를 1 감소
  my_year <- my_year - 1
}
 
```
